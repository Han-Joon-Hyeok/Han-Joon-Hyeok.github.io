<!DOCTYPE html><html lang="ko-KR" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.3.0" /><meta property="og:title" content="next.js 빌드 시 환경 변수가 undefined 인 문제 해결 (feat. docker-compose)" /><meta name="author" content="Joon Hyeok Han" /><meta property="og:locale" content="ko_KR" /><meta name="description" content="문제 상황" /><meta property="og:description" content="문제 상황" /><link rel="canonical" href="https://han-joon-hyeok.github.io/posts/next-js-env-variable-undefined-with-docker/" /><meta property="og:url" content="https://han-joon-hyeok.github.io/posts/next-js-env-variable-undefined-with-docker/" /><meta property="og:site_name" content="Dev Joon" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-08-28T01:25:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="next.js 빌드 시 환경 변수가 undefined 인 문제 해결 (feat. docker-compose)" /><meta name="twitter:site" content="@" /><meta name="twitter:creator" content="@Joon Hyeok Han" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Joon Hyeok Han"},"dateModified":"2024-10-02T17:26:07+09:00","datePublished":"2023-08-28T01:25:00+09:00","description":"문제 상황","headline":"next.js 빌드 시 환경 변수가 undefined 인 문제 해결 (feat. docker-compose)","mainEntityOfPage":{"@type":"WebPage","@id":"https://han-joon-hyeok.github.io/posts/next-js-env-variable-undefined-with-docker/"},"url":"https://han-joon-hyeok.github.io/posts/next-js-env-variable-undefined-with-docker/"}</script><title>next.js 빌드 시 환경 변수가 undefined 인 문제 해결 (feat. docker-compose) | Dev Joon</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-SKST7KNWSJ"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-SKST7KNWSJ'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/profile.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Dev Joon</a></div><div class="site-subtitle font-italic">성장하는 개발자, 한준혁입니다.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/Han-Joon-Hyeok" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['joonhyeok.han','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>next.js 빌드 시 환경 변수가 undefined 인 문제 해결 (feat. docker-compose)</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>next.js 빌드 시 환경 변수가 undefined 인 문제 해결 (feat. docker-compose)</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, Aug 28, 2023, 1:25 AM +0900" > Aug 28, 2023 <i class="unloaded">2023-08-28T01:25:00+09:00</i> </span> by <span class="author"> Joon Hyeok Han </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Wed, Oct 2, 2024, 5:26 PM +0900" > Oct 2, 2024 <i class="unloaded">2024-10-02T17:26:07+09:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1116 words">6 min</span></div></div><div class="post-content"><h1 id="문제-상황">문제 상황</h1><p>Next.js 로 작성한 프론트엔드 프로젝트를 docker 와 docker-compose 를 이용해서 컨테이너로 올리고 싶었다.</p><p>개발할 때는 <code class="language-plaintext highlighter-rouge">.env</code> 파일을 docker-compose 를 통해서 넣어줬고, 환경 변수를 잘 인식했다.</p><p>하지만 배포를 위해 <code class="language-plaintext highlighter-rouge">npm run build</code> 명령어로 빌드하고 <code class="language-plaintext highlighter-rouge">npm run start</code> 로 실행해보니 환경변수가 <code class="language-plaintext highlighter-rouge">undefined</code> 로 찍히는 상황을 마주했다.</p><h2 id="프로젝트-구조">프로젝트 구조</h2><p>프로젝트 폴더 구조는 아래와 같다.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nb">.</span>
├── .env
├── Makefile
├── README.md
├── <span class="k">**</span>backend/<span class="k">**</span>
├── docker-compose.dev.yml
├── docker-compose.yml
├── <span class="k">**</span>frontend/<span class="k">**</span>
└── <span class="k">**</span>types/<span class="k">**</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">.env</code> 파일은 프론트엔드, 백엔드 모두 공유하도록 구성했다.</p><p>사실 프론트엔드와 백엔드가 서로 공유하는 환경 변수는 없어서 굳이 같은 파일을 공유할 필요는 없다.</p><p>별도의 <code class="language-plaintext highlighter-rouge">.env</code> 파일로 관리하는 것이 맞는 것 같다.</p><h2 id="개발용-docker-환경">개발용 Docker 환경</h2><h3 id="docker-composedevyml">docker-compose.dev.yml</h3><p>개발용 docker compose 파일은 <code class="language-plaintext highlighter-rouge">docker-compose.dev.yml</code> 라는 이름으로 저장했다.</p><p>파일 내용은 아래와 같다.</p><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="c1"># docker-compose.yml</span>

<span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3"</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">frontend</span><span class="pi">:</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">frontend</span>
    <span class="na">build</span><span class="pi">:</span>
      <span class="na">context</span><span class="pi">:</span> <span class="s">./frontend</span>
      <span class="na">dockerfile</span><span class="pi">:</span> <span class="s">./Dockerfile.dev</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">frontend</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">3000:3000</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">on-failure:3</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./frontend:/app</span>
      <span class="pi">-</span> <span class="s">./types:/app/types</span>
    <span class="na">env_file</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">.env</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">naengmyeon_pong_network</span>

   <span class="s">...</span>

<span class="na">networks</span><span class="pi">:</span>
  <span class="na">naengmyeon_pong_network</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">bridge</span>
</pre></table></code></div></div><h3 id="dockerfiledev">Dockerfile.dev</h3><p><code class="language-plaintext highlighter-rouge">frontend</code> 폴더에 있는 docker 파일의 내용은 아래와 같다.</p><div class="language-docker highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="c"># Dockerfile.dev</span>

<span class="k">FROM</span><span class="s"> node:18-alpine</span>

<span class="k">RUN </span>apk add <span class="nt">--no-cache</span> dumb-init

<span class="k">WORKDIR</span><span class="s"> /app</span>

<span class="k">EXPOSE</span><span class="s"> 3000</span>

<span class="c"># Start dumb-init for PID 1</span>
<span class="k">ENTRYPOINT</span><span class="s"> [ "/usr/bin/dumb-init", "--" ]</span>

<span class="c"># Start react in the foreground</span>
<span class="k">CMD</span><span class="s"> [ "npm", "run", "dev" ]</span>
</pre></table></code></div></div><p>docker-compose 에서 <code class="language-plaintext highlighter-rouge">env_file</code> 항목에 <code class="language-plaintext highlighter-rouge">.env</code> 파일을 전달했을 때는 정상적으로 환경 변수가 출력되었다.</p><p>하지만, Dockerfile 에서 <code class="language-plaintext highlighter-rouge">npm run dev</code> 대신 <code class="language-plaintext highlighter-rouge">npm run build</code> 실행 이후 <code class="language-plaintext highlighter-rouge">npm run start</code> 로 바꾸니 환경 변수가 제대로 출력되지 않았던 것이다.</p><h1 id="문제-원인">문제 원인</h1><p>문제는 <code class="language-plaintext highlighter-rouge">npm run dev</code> 는 런타임 환경이고, <code class="language-plaintext highlighter-rouge">npm run start</code> 는 컴파일 후 생성된 정적 파일을 실행하는 환경이라는 차이점에서 발생했다.</p><p>런타임 환경에서는 컨테이너 내부에서 설정된 환경 변수를 사용해서 가져오는 것이었다.</p><p>즉, 컨테이너 내부에서 <code class="language-plaintext highlighter-rouge">env</code> 명령어를 실행하면 확인할 수 있는 환경 변수를 그대로 가져와서 사용하기 때문에 문제가 없었던 것이다.</p><p>하지만, <code class="language-plaintext highlighter-rouge">npm run build</code> 로 컴파일 할 때는 컨테이너 내부에서 선언된 환경 변수를 가져오는 것이 아니라 <code class="language-plaintext highlighter-rouge">package.json</code> 파일과 동일한 위치에 있는 <code class="language-plaintext highlighter-rouge">.env</code> 파일을 가져와서 환경 변수를 컴파일 한다.</p><h1 id="해결-방법">해결 방법</h1><p>개발용 Docker 환경과 배포용 Docker 환경을 다르게 설정해야 한다.</p><h2 id="배포용-docker-환경">배포용 Docker 환경</h2><h3 id="docker-composeyml">docker-compose.yml</h3><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3"</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">frontend</span><span class="pi">:</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">frontend</span>
    <span class="na">build</span><span class="pi">:</span>
      <span class="na">context</span><span class="pi">:</span> <span class="s">.</span> <span class="c1"># context 를 frontend 가 아닌 docker-compose.yml 파일 기준으로 설정</span>
      <span class="na">dockerfile</span><span class="pi">:</span> <span class="s">./frontend/Dockerfile</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">frontend</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">3000:3000</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">on-failure:3</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">naengmyeon_pong_network</span>

<span class="na">networks</span><span class="pi">:</span>
  <span class="na">naengmyeon_pong_network</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">bridge</span>
</pre></table></code></div></div><p>이번 프로젝트에서는 백엔드와 프론트엔드 .env 파일을 동시에 공유하고 있다.</p><p>그래서 docker-compose 파일에 이미지 빌드 시 context 를 docker-compose.yml 파일이 위치한 디렉토리로 설정해서 <code class="language-plaintext highlighter-rouge">.env</code> 파일을 가져올 수 있도록 설정한다.</p><h3 id="dockerfile">Dockerfile</h3><div class="language-docker highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="k">FROM</span><span class="s"> node:18-alpine</span>

<span class="k">RUN </span>apk add <span class="nt">--no-cache</span> dumb-init

<span class="k">WORKDIR</span><span class="s"> /app</span>

<span class="k">COPY</span><span class="s"> ./frontend /app</span>
<span class="k">COPY</span><span class="s"> ./types /app/types</span>

<span class="c"># docker-compose.yml 파일이 위치한 경로에서 .env 파일을 컨테이너 내부로 복사한다.</span>
<span class="k">COPY</span><span class="s"> ./.env .</span>

<span class="k">RUN </span>npm run build

<span class="k">EXPOSE</span><span class="s"> 3000</span>

<span class="k">ENTRYPOINT</span><span class="s"> [ "/usr/bin/dumb-init", "--" ]</span>

<span class="k">CMD</span><span class="s"> ["npm", "run", "start"]</span>

</pre></table></code></div></div><p>Dockerfile 에서는 <code class="language-plaintext highlighter-rouge">.env</code> 파일을 컨테이너 내부에 복사한다.</p><p>그러면 터미널에 정상적으로 <code class="language-plaintext highlighter-rouge">.env</code> 파일을 반영해서 컴파일 했다는 안내 문구가 표시된다.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="nv">$ </span>npm run build

<span class="o">&gt;</span> client@0.1.0 build
<span class="o">&gt;</span> next build

- info Loaded <span class="nb">env </span>from /Users/workspace/frontend/.env <span class="c"># 환경 변수를 불러왔다는 표시가 뜬다.</span>
- info Skipping linting
- info Checking validity of types
Warning: For production Image Optimization with Next.js, the optional <span class="s1">'sharp'</span> package is strongly recommended. Run <span class="s1">'yarn add sharp'</span>, and Next.js will use it automatically <span class="k">for </span>Image Optimization.
Read more: https://nextjs.org/docs/messages/sharp-missing-in-production
- info Creating an optimized production build ..
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/frontend/'>frontend</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/nextjs/" class="post-tag no-text-decoration">Nextjs</a> <a href="/tags/docker/" class="post-tag no-text-decoration">docker</a> <a href="/tags/docker-compose/" class="post-tag no-text-decoration">docker-compose</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=next.js 빌드 시 환경 변수가 undefined 인 문제 해결 (feat. docker-compose) - Dev Joon&url=https://han-joon-hyeok.github.io/posts/next-js-env-variable-undefined-with-docker/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=next.js 빌드 시 환경 변수가 undefined 인 문제 해결 (feat. docker-compose) - Dev Joon&u=https://han-joon-hyeok.github.io/posts/next-js-env-variable-undefined-with-docker/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=next.js 빌드 시 환경 변수가 undefined 인 문제 해결 (feat. docker-compose) - Dev Joon&url=https://han-joon-hyeok.github.io/posts/next-js-env-variable-undefined-with-docker/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/c-bitwise-operation-between-different-integer-sizes/">[C언어] 자료형 크기 차이로 인한 비트 연산 오류 해결 방법</a><li><a href="/posts/connect-to-ec2-without-ssh-key-using-session-manager/">[AWS] EC2 인스턴스 ssh 키 없이 터미널 접속하는 방법 (AWS Session Manager)</a><li><a href="/posts/how-to-access-geo-restricted-websites-using-mullvad-vpn/">국가 제한이 걸린 사이트에 접속하는 방법 (feat. Mullvad VPN)</a><li><a href="/posts/network-overview/">네트워크 LAN, WAN / 스위치, 라우터 / IP 주소 / 서브넷 개념 정리</a><li><a href="/posts/what-is-nat/">NAT란?</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/programmers/">programmers</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/level2/">level2</a> <a class="post-tag" href="/tags/level1/">level1</a> <a class="post-tag" href="/tags/javascript/">JavaScript</a> <a class="post-tag" href="/tags/os/">os</a> <a class="post-tag" href="/tags/pipex/">pipex</a> <a class="post-tag" href="/tags/born2beroot/">born2beroot</a> <a class="post-tag" href="/tags/git/">git</a> <a class="post-tag" href="/tags/data-structure/">Data Structure</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Next-js-google-typescript-style-with-eslint-and-prettier/"><div class="card-body"> <span class="timeago small" > Nov 14, 2023 <i class="unloaded">2023-11-14T09:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[Next.js] 협업을 위한 Google TyepScript Style 을 ESLint, Prettier 에 간단하게 적용하기</h3><div class="text-muted small"><p> 코드 스타일, 왜 맞춰야 할까? 협업할 때 코드를 각자의 스타일로 작성하다보면 다른 팀원이 작성한 코드를 읽기 어려울 때가 있다. 예를 들어, TypeScript 를 사용하는 팀원 A와 B의 코드 스타일이 아래의 표와 같다고 해보자.   A B 함수 정의 중괄...</p></div></div></a></div><div class="card"> <a href="/posts/next-js-failed-to-load-swc-binary/"><div class="card-body"> <span class="timeago small" > Mar 4, 2024 <i class="unloaded">2024-03-04T00:30:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[Next.js] Failed to load SWC binary for linux/x64 해결 방법</h3><div class="text-muted small"><p> 실행 환경 OS: MacOS(Intel) Sonoma 14.2.1 Node : 21.1.0 npm : 10.5.0 문제 상황 Next.js 개발 서버를 실행하기 위해 npm run dev 를 실행했다. 하지만 Failed to load SWC binary for linux/x64, see more info here: htt...</p></div></div></a></div><div class="card"> <a href="/posts/virtual-machine-and-docker/"><div class="card-body"> <span class="timeago small" > Apr 5, 2023 <i class="unloaded">2023-04-05T12:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>가상머신과 도커의 차이</h3><div class="text-muted small"><p> 가상머신과 도커의 차이 하나의 물리 서버를 효율적으로 사용하기 위해 ‘서버 가상화 기술’이 발전했다. 가상머신과 컨테이너는 모두 서버 가상화 기술을 적용한 것이다. 하지만 어떤 가상화 소프트웨어를 사용하는지, 어떤 시스템 레벨을 가상화하는지에 차이가 존재한다. 가상화 가상화는 컴퓨터에서 하나의 물리 하드웨어 시스템에서 여러 가상 시스템을 실행...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/42seoul-nginx-sampling-project-retrospect/" class="btn btn-outline-primary" prompt="Older"><p>[회고] 42서울 C++ 기반 nginx 샘플링 프로젝트 회고</p></a> <a href="/posts/about-redis/" class="btn btn-outline-primary" prompt="Newer"><p>Redis 개념, 장점과 단점, Docker 사용 예시 정리</p></a></div><script src="https://utteranc.es/client.js" repo="Han-Joon-Hyeok/Han-Joon-Hyeok.github.io" issue-term="pathname" label="Comments" theme="preferred-color-scheme" crossorigin="anonymous" async> </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/han-joon-hyeok">Joon Hyeok Han</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/programmers/">programmers</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/level2/">level2</a> <a class="post-tag" href="/tags/level1/">level1</a> <a class="post-tag" href="/tags/javascript/">JavaScript</a> <a class="post-tag" href="/tags/os/">os</a> <a class="post-tag" href="/tags/pipex/">pipex</a> <a class="post-tag" href="/tags/born2beroot/">born2beroot</a> <a class="post-tag" href="/tags/git/">git</a> <a class="post-tag" href="/tags/data-structure/">Data Structure</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://han-joon-hyeok.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
