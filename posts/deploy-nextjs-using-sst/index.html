<!DOCTYPE html><html lang="ko-KR" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.3.0" /><meta property="og:title" content="[Next.js] Vercel 대신 AWS 에 배포하기(feat.SST)" /><meta name="author" content="Joon Hyeok Han" /><meta property="og:locale" content="ko_KR" /><meta name="description" content="개요" /><meta property="og:description" content="개요" /><link rel="canonical" href="https://han-joon-hyeok.github.io/posts/deploy-nextjs-using-sst/" /><meta property="og:url" content="https://han-joon-hyeok.github.io/posts/deploy-nextjs-using-sst/" /><meta property="og:site_name" content="Dev Joon" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-10-02T17:20:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="[Next.js] Vercel 대신 AWS 에 배포하기(feat.SST)" /><meta name="twitter:site" content="@" /><meta name="twitter:creator" content="@Joon Hyeok Han" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Joon Hyeok Han"},"dateModified":"2024-10-02T17:20:00+09:00","datePublished":"2024-10-02T17:20:00+09:00","description":"개요","headline":"[Next.js] Vercel 대신 AWS 에 배포하기(feat.SST)","mainEntityOfPage":{"@type":"WebPage","@id":"https://han-joon-hyeok.github.io/posts/deploy-nextjs-using-sst/"},"url":"https://han-joon-hyeok.github.io/posts/deploy-nextjs-using-sst/"}</script><title>[Next.js] Vercel 대신 AWS 에 배포하기(feat.SST) | Dev Joon</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-SKST7KNWSJ"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-SKST7KNWSJ'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/profile.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Dev Joon</a></div><div class="site-subtitle font-italic">성장하는 개발자, 한준혁입니다.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/Han-Joon-Hyeok" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['joonhyeok.han','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>[Next.js] Vercel 대신 AWS 에 배포하기(feat.SST)</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>[Next.js] Vercel 대신 AWS 에 배포하기(feat.SST)</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, Oct 2, 2024, 5:20 PM +0900" > Oct 2, 2024 <i class="unloaded">2024-10-02T17:20:00+09:00</i> </span> by <span class="author"> Joon Hyeok Han </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="5304 words">29 min</span></div></div><div class="post-content"><h1 id="개요">개요</h1><p>Next.js 프로젝트를 SSR 방식으로 AWS 에 간편하게 배포하기 위해 SST 라이브러리를 이용했다.</p><p>SST 라이브러리를 이용하면 아래의 표와 같은 AWS 서비스를 사용한다.</p><div class="table-wrapper"><table><thead><tr><th>서비스<th>설명<tbody><tr><td>Lambda<td>Next.js 의 SSR 을 가능하도록 하는 서버리스 컴퓨팅.<tr><td>CloudFront<td>프론트엔드 정적 파일들을 전달해주는 CDN.<tr><td>Route53<td>도메인으로 접속 했을 때 CloudFront 와 연결해주는 DNS.<tr><td>Certificate Manager<td>도메인 HTTPS 접속 연결을 위한 인증서 발급.<tr><td>S3<td>프론트엔드 정적 파일 및 캐시 파일을 저장하는 Storage.<tr><td>CloudWatch<td>프론트엔드 접속 요청 로그 수집.<tr><td>CodeDeploy<td>GitHub Repository 에서 소스 코드를 가져와서 자동 빌드 후 배포.</table></div><p>SST 를 이용해서 배포한 AWS 서비스 구조를 그림으로 표현하면 아래의 이미지와 같다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2024/2024-10-02-deploy-nextjs-using-sst/1.png" alt="1.png" /></p><p>본 게시물은 사이드 프로젝트를 AWS 에 배포하기 위한 SST 라이브러리 사용 방법 및 CI/CD 구축 방법에 대해 정리하였다.</p><h1 id="vercel-을-사용하지-않은-이유">Vercel 을 사용하지 않은 이유</h1><p>GitHub Organization Repository 를 사용하는 사이드 프로젝트에서는 Vercel 을 사용하는 것보다 AWS 에 배포하는 것이 약 75% 저렴하다. (1달 기준 Vercel = 20 USD, AWS = 5 USD)</p><h2 id="vercel-요금-체계">Vercel 요금 체계</h2><p>Vercel 은 배포하고자 하는 GitHub Organization Repository 에 대해 1개월에 팀원 1명당 20달러(약 26,000원)를 지불해야 한다.</p><p>여기서 의미하는 팀원은 GitHub Organization 에 소속된 팀원이 아닌 Vercel 사이트에서 생성한 계정으로 해당 GitHub Organization Repository 의 대시보드에 접근할 수 있는 팀원을 의미한다.</p><p>Vercel 을 이용하면 클릭 몇 번으로 빠르고 간편하게 서비스를 배포할 수 있고, 다양한 모니터링 기능도 이용할 수 있다.</p><p>즉, Vercel 이 제공하는 간편하고 편리한 기능들을 팀원들과 함께 사용하기 위해서는 20 + (20 * N명) 만큼 결제해야 한다.</p><p>물론 무료로 배포할 수 있는 방법이 있긴 하다.</p><p>GitHub Organization 에 소속된 Repository 를 개인 계정의 Repository 로 fork 해서 배포하면 된다.</p><p>하지만 이렇게 하면 배포한 서비스를 모니터링 할 수 있는 Vercel 계정이 오직 1개로 제한된다.</p><p>다시 말해서, 다른 팀원들이 Vercel 대시보드에 접속해서 모니터링을 하려면 배포한 Vercel 계정의 로그인 정보를 알아야 한다는 것이다.</p><p>개인 정보를 공유하는 것은 보안 상 바람직하지 않기 때문에 이 방법을 사용하지 않았다.</p><h2 id="aws-요금-체계">AWS 요금 체계</h2><p>AWS 는 사용한 만큼만 지불하는 On-Demand 방식이다.</p><p>AWS 에서 제공하는 프리 티어 혜택을 잘 이용하면 프론트엔드는 1달에 약 5달러 정도만 지불하면 된다.</p><p>또한, AWS 크레딧을 이용해서 지불할 수 있기 때문에 무료로 받은 크레딧으로 결제가 가능하다는 장점이 있다.</p><p>이번 사이드 프로젝트를 위해 사용할 수 있는 크레딧이 약 $150 있었기 때문에 비용 부담을 덜 수 있었다.</p><h2 id="sst-라이브러리-적극-활용하기">SST 라이브러리 적극 활용하기</h2><p>SST 에서도 Vercel 만큼 많은 기능을 지원하는 건 아니지만 웹 대시보드를 제공하고 있다.</p><p>GitHub Repository 의 main 브랜치에 push 가 발생하면 CI/CD 를 알아서 구축해주는 편리한 기능도 지원하기 때문에 Vercel 의 대안으로 적합했다.</p><h1 id="sst">SST</h1><h2 id="소개">소개</h2><p>SST 는 프론트엔드 프레임워크(Next.js, Remix, Svelte 등)를 AWS 나 CloudFlare 에 배포할 수 있도록 돕는 라이브러리이다.</p><p>2024년 8월 27일 기준 최신 버전은 v3 이며, SST ION(<a href="https://github.com/sst/ion">GitHub 링크</a>)이라는 이름의 프로젝트로 개발 중이다.</p><p>v3 에서는 ION 은 Pulumi 와 Terraform 을 이용해서 코드로 인프라를 관리하는 IaC(Infrastructure as Code)를 구현했다.</p><p>참고로 v2 에서는 CloudFormation 을 이용해서 AWS 자원을 생성했다. 하지만, AWS 자원이 정상적으로 삭제 되지 않거나, CDK(Cloud Development Kit)에서 오류 메세지에 명확한 원인을 표시하지 않는 문제가 있었다고 한다. 자세한 내용은 아래의 링크에서 확인할 수 있다.</p><ul><li>참고자료: <a href="https://sst.dev/blog/moving-away-from-cdk">Moving away from CDK</a> [SST]</ul><h2 id="주요-기능">주요 기능</h2><p>SST 는 자체적으로 운영하고 있는 Console 페이지(<a href="https://console.sst.dev/habitpay/frontend/autodeploy">링크</a>)를 통해 여러 편리한 기능을 제공하고 있다.</p><h3 id="cicd-지원">CI/CD 지원</h3><p>SST 는 배포하고자 하는 프로젝트의 GitHub Repository 에 연결하면 자동으로 배포해주는 CI/CD 기능을 지원한다.</p><p>내부적으로 AWS CodeDeploy 를 이용해서 배포를 자동화하고 있다.</p><p>Console 페이지를 통해 배포가 정상적으로 이루어졌는지 확인할 수 있다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2024/2024-10-02-deploy-nextjs-using-sst/2.png" alt="2.png" /></p><h3 id="aws-사용-중인-자원-목록-표시">AWS 사용 중인 자원 목록 표시</h3><p>AWS 에서 사용 중인 자원들의 목록을 표시해준다.</p><p>배포를 위해 많은 AWS 자원을 생성하는데, 어떤 자원이 생성되었는지 쉽게 확인할 수 있도록 도와준다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2024/2024-10-02-deploy-nextjs-using-sst/3.png" alt="3.png" /></p><h3 id="로그-수집">로그 수집</h3><p>Lambda 에서 실행한 코드의 로그를 수집해서 표시해준다.</p><p>내부적으로 AWS CloudWatch 를 이용한다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2024/2024-10-02-deploy-nextjs-using-sst/4.png" alt="4.png" /></p><h2 id="사용-이유">사용 이유</h2><p>Next.js 를 SST 로 배포한 이유는 크게 3가지로 정리할 수 있다.</p><h3 id="1-비용-부담-낮추기">1. 비용 부담 낮추기</h3><p>위에서 언급하긴 했지만, AWS 서비스를 사용하는 만큼만 비용을 지불하고, 크레딧으로 결제가 가능해서 비용 부담을 낮출 수 있었다.</p><h3 id="2-서버리스를-이용한-ssr-방식-배포">2. 서버리스를 이용한 SSR 방식 배포</h3><p>처음에는 Next.js 를 SSG 방식으로 빌드해서 AWS S3 에 업로드 하고자 했다.</p><p>이전에 Next.js 를 배포한 경험은 없었고, React 를 정적 파일로 빌드해서 배포한 경험만 있었기 때문에 Next.js 도 SSG 방식을 이용하면 될거라 생각했다.</p><p>하지만, 이번 프로젝트에서는 Dynamic Routes(동적 라우팅) 기능(<a href="https://nextjs.org/docs/pages/building-your-application/routing/dynamic-routes">참고 자료</a>)을 이용하고 있어서 SSG 로 빌드하는 것이 불가능했다.</p><p>SSG 방식으로 Dynamic Routes 를 이용할 수 있는 방법은 아무리 찾아봐도 존재하지 않아서 SSR 방식으로 배포하기로 했다.</p><p>SSR 방식으로 배포하기 위해 2가지 선택지가 있었다.</p><ol><li>EC2 에서 <code class="language-plaintext highlighter-rouge">npm run start</code> 명령어를 실행하여 배포<li>AWS 서버리스(Lambda) 서비스를 이용한 배포</ol><p>결론부터 말하면 비용 절감 및 간편한 배포를 위해 2번을 선택했다.</p><p>1번 방식을 이용하면 EC2 실행 시간 비용 + EBS 비용이 매월 꼬박꼬박 발생한다.</p><p>t4g.small 기준으로 1개월 실행 비용만 $12 이고, EBS 15G 는 약 $1.4 이다.</p><p>이 외에도 다른 비용을 합산하면 최소 월 $14 이상 지불해야 한다.</p><p>이에 비해 AWS Lambda 는 매월 아래와 같은 사용량에 대해 프리티어를 제공한다.</p><ul><li>월별 무료 요청 <strong>1,000,000</strong>건<li>월별 <strong>최대 320만 초</strong>의 컴퓨팅 시간</ul><p>프리티어를 초과한 사용량에 대한 계산을 위해 아래와 같은 상황을 가정해보자.</p><ul><li>월 요청 건수: 5,000,000건<li>평균 실행 시간: 0.5초<li>메모리: 512MB(0.5GB)</ul><ol><li>요청 건수에 대한 비용<ul><li>5,000,000 - 1,000,000(프리티어) = 4,000,000건<li>1,000,000 건당 $0.20<li>0.2 * 4 = <strong>$0.8</strong></ul><li>컴퓨팅 시간에 대한 비용<ul><li>5,000,000 * 0.5 = 2,500,000 초<li>2,500,000 초 * 0.5GB = 1,250,000 GB/초<li>(1,250,000 GB/초 - 320,000 GB/초) * 0.0000166667 = <strong>$15.51</strong></ul><li>총 비용<ul><li>$0.8 + $15.51 = <strong>$16.31</strong></ul></ol><p>단순 비용만 놓고 보면 EC2 와 유사한 수준이다.</p><p>하지만, 포트폴리오 목적의 사이드 프로젝트에서 5백만 건 이상의 요청이 들어오기는 어렵기에 실제로는 $16 이하의 요금이 청구될 것이다.</p><p>실제로 비용이 얼마나 발생할 지는 서비스를 운영해봐야 알겠지만, 계산만으로는 EC2 보다 Lambda 를 이용하는 것이 훨씬 경제적이라는 것을 알 수 있다.</p><h3 id="3-간편한-cicd-구축-및-https-인증서-적용">3. 간편한 CI/CD 구축 및 HTTPS 인증서 적용</h3><p>앞선 2번과 이어지는 맥락이다.</p><p>EC2 에 배포한다면 CI/CD 구축을 위해 GitHub Actions 를 이용할 수 있다.</p><p>하지만, SST 는 클릭 몇 번으로 GitHub Repository 와 연동해서 GitHub Actions 를 위한 코드를 작성하지 않아도 CI/CD 를 간편하게 구축할 수 있다.</p><p>그리고 HTTPS 통신을 위한 인증서 적용을 위해 certbot 을 이용해서 주기적으로 인증서를 발급 및 갱신하거나, CloudFront 를 EC2 와 연결해서 AWS 에서 발급하는 인증서를 적용할 수도 있다.</p><p>또한, SST 를 이용해서 배포하면 CloudFront 를 통한 요청에 대해서도 ACM(AWS Certificate Manager)에서 HTTPS 인증서도 알아서 발급하고 적용해주기 때문에 간편하다.</p><h1 id="sst-사용-방법">SST 사용 방법</h1><p>아래의 내용은 SST 라이브러리 공식 문서(<a href="https://sst.dev/docs/start/aws/nextjs">링크</a>)를 참고해서 작성했다.</p><h2 id="개발-환경">개발 환경</h2><ul><li>OS: macOS 14.6.1</ul><h2 id="1-sst-라이브러리-설치">1. SST 라이브러리 설치</h2><p>Next.js 디렉토리에서 터미널에 아래의 명령어를 실행한다.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>npx sst init
npm <span class="nb">install</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">sst.config.ts</code> 파일이 생성되며, 초기 내용은 아래와 같다.</p><div class="language-tsx highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="c1">// sst.config.ts</span>

<span class="c1">/// &lt;reference path="./.sst/platform/config.d.ts" /&gt;</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">$config</span><span class="p">({</span>
  <span class="nx">app</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ion</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">removal</span><span class="p">:</span> <span class="nx">input</span><span class="p">?.</span><span class="nx">stage</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">production</span><span class="dl">"</span> <span class="p">?</span> <span class="dl">"</span><span class="s2">retain</span><span class="dl">"</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">remove</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">home</span><span class="p">:</span> <span class="dl">"</span><span class="s2">aws</span><span class="dl">"</span><span class="p">,</span>
    <span class="p">};</span>
  <span class="p">},</span>
  <span class="k">async</span> <span class="nx">run</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">new</span> <span class="nx">sst</span><span class="p">.</span><span class="nx">aws</span><span class="p">.</span><span class="nx">Nextjs</span><span class="p">(</span><span class="dl">"</span><span class="s2">MyWeb</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">},</span>
<span class="p">});</span>
</pre></table></code></div></div><h2 id="2-sstconfigts-파일-설정">2. <code class="language-plaintext highlighter-rouge">sst.config.ts</code> 파일 설정</h2><h3 id="region-설정">region 설정</h3><p>Autodeploy 기능을 이용하기 위해 배포할 region 을 설정한다.</p><p><code class="language-plaintext highlighter-rouge">app()</code> 함수에 <code class="language-plaintext highlighter-rouge">providers</code> 속성을 아래와 같이 추가한다.</p><div class="language-tsx highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>  <span class="nx">app</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">frontend</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">removal</span><span class="p">:</span> <span class="nx">input</span><span class="p">?.</span><span class="nx">stage</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">production</span><span class="dl">"</span> <span class="p">?</span> <span class="dl">"</span><span class="s2">retain</span><span class="dl">"</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">remove</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">home</span><span class="p">:</span> <span class="dl">"</span><span class="s2">aws</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">providers</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">aws</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">region</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ap-northeast-2</span><span class="dl">"</span><span class="p">,</span>
        <span class="p">},</span>
      <span class="p">},</span>
    <span class="p">};</span>
  <span class="p">},</span>
</pre></table></code></div></div><p>참고로 region 을 명시하지 않으면 기본으로 <code class="language-plaintext highlighter-rouge">us-east-1</code> 에 배포가 이루어진다.</p><p>region 값은 민감한 정보일 수 있기 때문에 하드 코드 값을 넣는 대신 아래와 같이 환경 변수로 대체할 수 있다.</p><div class="language-tsx highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>  <span class="nx">app</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">frontend</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">removal</span><span class="p">:</span> <span class="nx">input</span><span class="p">?.</span><span class="nx">stage</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">production</span><span class="dl">"</span> <span class="p">?</span> <span class="dl">"</span><span class="s2">retain</span><span class="dl">"</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">remove</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">home</span><span class="p">:</span> <span class="dl">"</span><span class="s2">aws</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">providers</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">aws</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">region</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">AWS_REGION</span><span class="p">,</span>
        <span class="p">},</span>
      <span class="p">},</span>
    <span class="p">};</span>
  <span class="p">},</span>
</pre></table></code></div></div><p>환경 변수는 SST Console 페이지에서 설정 가능한데, 이 부분은 아래에서 자세히 설명할 것이다.</p><h3 id="자동-배포-설정">자동 배포 설정</h3><p>main 브랜치에 push 되었을 때만 배포할 수 있도록 아래와 같이 <code class="language-plaintext highlighter-rouge">console</code> 속성을 추가한다.</p><p>이 부분은 CI/CD 구축할 때 필요하다.</p><p>자세한 내용은 아래에서 확인할 수 있다.</p><div class="language-tsx highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre>  <span class="nx">app</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ... 생략</span>
  <span class="p">},</span>

  <span class="c1">// &lt;-- 이하 추가한 부분</span>
  <span class="nx">console</span><span class="p">:</span> <span class="p">{</span>
    <span class="nl">autodeploy</span><span class="p">:</span> <span class="p">{</span>
      <span class="nx">target</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span>
          <span class="nx">event</span><span class="p">.</span><span class="kd">type</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">branch</span><span class="dl">"</span> <span class="o">&amp;&amp;</span>
          <span class="nx">event</span><span class="p">.</span><span class="nx">branch</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">main</span><span class="dl">"</span> <span class="o">&amp;&amp;</span>
          <span class="nx">event</span><span class="p">.</span><span class="nx">action</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">pushed</span><span class="dl">"</span>
        <span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="p">{</span>
            <span class="na">stage</span><span class="p">:</span> <span class="dl">"</span><span class="s2">production</span><span class="dl">"</span><span class="p">,</span>
          <span class="p">};</span>
        <span class="p">}</span>
      <span class="p">},</span>
    <span class="p">},</span>
  <span class="p">},</span>
  <span class="c1">// 이상 추가한 부분 --&gt;</span>

  <span class="k">async</span> <span class="nx">run</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 생략...</span>
  <span class="p">},</span>
</pre></table></code></div></div><h3 id="도메인-연결">도메인 연결</h3><p>CloudFront 과 연결할 도메인을 <code class="language-plaintext highlighter-rouge">run()</code> 함수에 명시할 수 있다.</p><p>도메인은 이미 구매한 상태여야 하며, AWS Route53 에서 구매하는 것이 가장 간편하다.</p><div class="language-tsx highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">async</span> <span class="nx">run</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">new</span> <span class="nx">sst</span><span class="p">.</span><span class="nx">aws</span><span class="p">.</span><span class="nx">Nextjs</span><span class="p">(</span><span class="dl">"</span><span class="s2">Habitpayfrontend</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">domain</span><span class="p">:</span> <span class="dl">"</span><span class="s2">habitpay.link</span><span class="dl">"</span><span class="p">,</span> <span class="c1">// 사용할 도메인 입력.</span>
  <span class="p">});</span>
<span class="p">},</span>
</pre></table></code></div></div><h3 id="전체-설정-파일">전체 설정 파일</h3><div class="language-tsx highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre><span class="c1">/// &lt;reference path="./.sst/platform/config.d.ts" /&gt;</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">$config</span><span class="p">({</span>
  <span class="nx">app</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">frontend</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">removal</span><span class="p">:</span> <span class="nx">input</span><span class="p">?.</span><span class="nx">stage</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">production</span><span class="dl">"</span> <span class="p">?</span> <span class="dl">"</span><span class="s2">retain</span><span class="dl">"</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">remove</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">home</span><span class="p">:</span> <span class="dl">"</span><span class="s2">aws</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">providers</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">aws</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">region</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ap-northeast-2</span><span class="dl">"</span><span class="p">,</span>
        <span class="p">},</span>
      <span class="p">},</span>
    <span class="p">};</span>
  <span class="p">},</span>
  <span class="na">console</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">autodeploy</span><span class="p">:</span> <span class="p">{</span>
      <span class="nx">target</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span>
          <span class="nx">event</span><span class="p">.</span><span class="kd">type</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">branch</span><span class="dl">"</span> <span class="o">&amp;&amp;</span>
          <span class="nx">event</span><span class="p">.</span><span class="nx">action</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">pushed</span><span class="dl">"</span> <span class="o">&amp;&amp;</span>
          <span class="nx">event</span><span class="p">.</span><span class="nx">branch</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">main</span><span class="dl">"</span>
        <span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="p">{</span>
            <span class="na">stage</span><span class="p">:</span> <span class="dl">"</span><span class="s2">production</span><span class="dl">"</span><span class="p">,</span>
          <span class="p">};</span>
        <span class="p">}</span>
      <span class="p">},</span>
    <span class="p">},</span>
  <span class="p">},</span>
  <span class="k">async</span> <span class="nx">run</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">new</span> <span class="nx">sst</span><span class="p">.</span><span class="nx">aws</span><span class="p">.</span><span class="nx">Nextjs</span><span class="p">(</span><span class="dl">"</span><span class="s2">Habitpayfrontend</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">domain</span><span class="p">:</span> <span class="dl">"</span><span class="s2">habitpay.link</span><span class="dl">"</span><span class="p">,</span>
    <span class="p">});</span>
  <span class="p">},</span>
<span class="p">});</span>
</pre></table></code></div></div><h2 id="3-aws-iam-권한-설정">3. AWS IAM 권한 설정</h2><p>SST 가 나의 AWS 계정에 AWS 자원을 생성하기 위해 필요한 권한을 부여해주어야 한다.</p><p><code class="language-plaintext highlighter-rouge">AdministratorAccess</code> 를 주는 것이 가장 간단하지만, 최소 권한만 부여하는 것이 보안상 안전하며 AWS 에서 권장하는 방법이기 때문에 최소 권한만 부여한다.</p><h3 id="사용자-생성">사용자 생성</h3><p>SST 가 사용할 사용자 계정을 먼저 생성한다.</p><p>[IAM] - [사용자] 페이지에서 [사용자 생성] 버튼을 클릭한다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2024/2024-10-02-deploy-nextjs-using-sst/5.png" alt="5.png" /></p><p>사용자 이름은 자유롭게 입력 후 [다음] 클릭.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2024/2024-10-02-deploy-nextjs-using-sst/6.png" alt="6.png" /></p><p>[직접 정책 연결] 선택 후 [정책 생성] 버튼 클릭.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2024/2024-10-02-deploy-nextjs-using-sst/7.png" alt="7.png" /></p><p>[JSON] 선택.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2024/2024-10-02-deploy-nextjs-using-sst/8.png" alt="8.png" /></p><p>기본으로 작성되어 있는 JSON 대신 아래의 내용 입력.</p><p><code class="language-plaintext highlighter-rouge">Resource</code> 속성에 있는 <code class="language-plaintext highlighter-rouge">REGION</code> 과 <code class="language-plaintext highlighter-rouge">ACCOUNT</code> 는 각자 사용하는 정보에 맞춰서 변경한다.</p><div class="language-json highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
    </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
          </span><span class="nl">"Sid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ManageBootstrapStateBucket"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
              </span><span class="s2">"s3:CreateBucket"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"s3:PutBucketVersioning"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"s3:PutBucketNotification"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"s3:DeleteObject"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"s3:GetObject"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"s3:ListBucket"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"s3:PutObject"</span><span class="w">
          </span><span class="p">],</span><span class="w">
          </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
              </span><span class="s2">"arn:aws:s3:::sst-state-*"</span><span class="w">
          </span><span class="p">]</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
          </span><span class="nl">"Sid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ManageBootstrapAssetBucket"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
              </span><span class="s2">"s3:CreateBucket"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"s3:PutBucketVersioning"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"s3:DeleteObject"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"s3:GetObject"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"s3:ListBucket"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"s3:PutObject"</span><span class="w">
          </span><span class="p">],</span><span class="w">
          </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
              </span><span class="s2">"arn:aws:s3:::sst-asset-*"</span><span class="w">
          </span><span class="p">]</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
          </span><span class="nl">"Sid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ManageBootstrapECRRepo"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
              </span><span class="s2">"ecr:CreateRepository"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"ecr:DescribeRepositories"</span><span class="w">
          </span><span class="p">],</span><span class="w">
          </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
              </span><span class="s2">"arn:aws:ecr:REGION:ACCOUNT:repository/sst-asset"</span><span class="w">
          </span><span class="p">]</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
          </span><span class="nl">"Sid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ManageBootstrapSSMParameter"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
              </span><span class="s2">"ssm:GetParameters"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"ssm:PutParameter"</span><span class="w">
          </span><span class="p">],</span><span class="w">
          </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
              </span><span class="s2">"arn:aws:ssm:REGION:ACCOUNT:parameter/sst/passphrase/*"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"arn:aws:ssm:REGION:ACCOUNT:parameter/sst/bootstrap"</span><span class="w">
          </span><span class="p">]</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
          </span><span class="nl">"Sid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Deployments"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
              </span><span class="s2">"*"</span><span class="w">
          </span><span class="p">],</span><span class="w">
          </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
              </span><span class="s2">"*"</span><span class="w">
          </span><span class="p">]</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
          </span><span class="nl">"Sid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ManageSecrets"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
              </span><span class="s2">"ssm:DeleteParameter"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"ssm:GetParameter"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"ssm:GetParameters"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"ssm:GetParametersByPath"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"ssm:PutParameter"</span><span class="w">
          </span><span class="p">],</span><span class="w">
          </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
              </span><span class="s2">"arn:aws:ssm:REGION:ACCOUNT:parameter/sst/*"</span><span class="w">
          </span><span class="p">]</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
          </span><span class="nl">"Sid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"LiveLambdaSocketConnection"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
              </span><span class="s2">"iot:DescribeEndpoint"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"iot:Connect"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"iot:Subscribe"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"iot:Publish"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"iot:Receive"</span><span class="w">
          </span><span class="p">],</span><span class="w">
          </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
              </span><span class="s2">"*"</span><span class="w">
          </span><span class="p">]</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>[정책 이름] 작성 후 하단에 [정책 생성] 버튼 클릭</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2024/2024-10-02-deploy-nextjs-using-sst/9.png" alt="9.png" /></p><p>[사용자 생성] 페이지에서 [새로고침] 버튼 클릭 후 방금 생성한 정책 검색 후 선택.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2024/2024-10-02-deploy-nextjs-using-sst/10.png" alt="10.png" /></p><p>[사용자 생성] 버튼 클릭.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2024/2024-10-02-deploy-nextjs-using-sst/11.png" alt="11.png" /></p><h3 id="액세스-키-생성">액세스 키 생성</h3><p>로컬 환경에서 배포하기 위해서는 액세스 키가 필요하다.</p><p>[IAM] - [사용자 관리] - [사용자]에서 방금 생성한 사용자를 선택한다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2024/2024-10-02-deploy-nextjs-using-sst/12.png" alt="12.png" /></p><p>[보안 자격 증명] 탭을 선택해서 [액세스 키 만들기] 버튼을 클릭한다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2024/2024-10-02-deploy-nextjs-using-sst/13.png" alt="13.png" /></p><p>[Command Line Interface(CLI)] 선택 - [확인] 체크박스 선택 - [다음] 버튼 클릭한다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2024/2024-10-02-deploy-nextjs-using-sst/14.png" alt="14.png" /></p><p>액세스 키를 생성하면 아래와 같이 [액세스 키]와 [비밀 액세스 키]가 표시된다.</p><p>[비밀 액세스 키]는 이 화면에서 보여주는게 전부이기 때문에 반드시 저장해두어야 한다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2024/2024-10-02-deploy-nextjs-using-sst/15.png" alt="15.png" /></p><p>발급한 액세스 키를 로컬 환경에 등록하기 위해 터미널에서 아래의 명령어를 실행한다.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>aws configure
</pre></table></code></div></div><p>만약 aws cli 가 설치되지 않았다면 <code class="language-plaintext highlighter-rouge">brew install awscli</code> 를 실행해서 설치한다. (macOS 기준)</p><p>액세스 키, 비밀 액세스 키, 리전, 출력 형식을 입력한다.</p><p>출력 형식은 json 으로 입력했다.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>AWS Access Key ID <span class="o">[</span>None]: <span class="o">[</span>access key]
AWS Secret Access Key <span class="o">[</span>None]: <span class="o">[</span>secret key]
Default region name <span class="o">[</span>None]: <span class="o">[</span>region name] <span class="c"># ap-northeast-2</span>
Default output format <span class="o">[</span>None]: json
</pre></table></code></div></div><p>아래의 명령어를 실행해서 설정이 잘 되었는지 확인한다.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>aws sts get-caller-identity
<span class="c">#{</span>
<span class="c">#    "UserId": "[access-key]",</span>
<span class="c">#    "Account": "[AWS-ID]",</span>
<span class="c">#    "Arn": "arn:aws:iam::[AWS-ID]:user/[user-name]"</span>
<span class="c">#}</span>
</pre></table></code></div></div><h2 id="4-console-페이지에-aws-계정-연동하기">4. console 페이지에 AWS 계정 연동하기</h2><p>배포가 잘 되었는지 확인하기 위해 SST 라이브러리에서 제공하는 console 페이지를 이용할 것이다.</p><p>https://console.sst.dev/ 로 접속하면 아래와 같이 이메일로 로그인 하는 화면이 표시된다.</p><h3 id="로그인">로그인</h3><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2024/2024-10-02-deploy-nextjs-using-sst/16.png" alt="16.png" /></p><p>이메일로 로그인을 위한 숫자 6자리가 발송되는데, 받을 이메일을 작성하고 [Continue] 버튼을 클릭한다.</p><p>이메일을 확인하면 아래와 같이 숫자 6자리가 도착했을 것이다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2024/2024-10-02-deploy-nextjs-using-sst/17.png" alt="17.png" /></p><p>아래와 같은 화면에 숫자를 입력한다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2024/2024-10-02-deploy-nextjs-using-sst/18.png" alt="18.png" /></p><h3 id="workspace-생성">Workspace 생성</h3><p>로그인을 마치면 Workspace 생성 화면이 표시된다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2024/2024-10-02-deploy-nextjs-using-sst/19.png" alt="19.png" /></p><p>사용하고자 하는 이름을 입력하고 [Create Workspace] 버튼을 클릭한다.</p><h3 id="aws-계정-연동">AWS 계정 연동</h3><p>Workspace 를 생성하면 아래와 같이 AWS 계정과 연동하라는 화면이 표시된다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2024/2024-10-02-deploy-nextjs-using-sst/20.png" alt="20.png" /></p><p>[Connect an AWS Account] 버튼을 클릭해서 AWS 계정으로 로그인한다.</p><p>로그인을 마치면 CloudFormation 스택 생성 화면이 아래와 같이 표시된다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2024/2024-10-02-deploy-nextjs-using-sst/21.png" alt="21.png" /></p><p>입력된 항목들은 수정하지 않은 채로 페이지 하단으로 내려서 [<strong>AWS CloudFormation에서 사용자 지정 이름으로 IAM 리소스를 생성할 수 있음을 승인합니다.]</strong> 버튼에 체크표시를 한다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2024/2024-10-02-deploy-nextjs-using-sst/22.png" alt="22.png" /></p><p>CloudFormation 스택 생성이 끝나면 SST console 페이지는 아래와 같이 표시된다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2024/2024-10-02-deploy-nextjs-using-sst/23.png" alt="23.png" /></p><h2 id="5-로컬-환경">5. 로컬 환경</h2><h3 id="배포">배포</h3><p>Next.js 프로젝트가 있는 루트 디렉토리에서 아래의 명령어를 실행한다.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>npx sst deploy <span class="nt">--stage</span> production
</pre></table></code></div></div><p>배포까지 약 5분 ~ 10분 정도 걸린다.</p><p>배포가 정상적으로 끝나면 아래와 같이 표시된다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2024/2024-10-02-deploy-nextjs-using-sst/24.png" alt="24.png" /></p><h3 id="삭제">삭제</h3><p>마찬가지로 Next.js 프로젝트가 있는 루트 디렉토리에서 아래의 명령어를 실행한다.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>npx sst remove <span class="nt">--stage</span> production
</pre></table></code></div></div><p>삭제도 약 5분 ~ 10분 정도 걸린다.</p><p>삭제가 완료되면 아래와 같이 표시된다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2024/2024-10-02-deploy-nextjs-using-sst/25.png" alt="25.png" /></p><h2 id="6-cicd-구축">6. CI/CD 구축</h2><p>SST 라이브러리에서 제공하는 console 페이지의 autodeploy 기능을 이용하면 GitHub Repository 와 연결할 수 있다.</p><p>autodeploy 를 이용하면 Repository 의 특정 브랜치에 push 이벤트가 발생하면 자동으로 빌드 및 배포까지 할 수 있다.</p><p>CI/CD 구축을 위해서는 로컬에서 먼저 배포를 해주어야 한다.</p><h3 id="sst-설정-파일-확인">SST 설정 파일 확인</h3><p>autodeploy 설정이 잘 되어있는지 <code class="language-plaintext highlighter-rouge">sst.config.ts</code> 파일을 확인한다.</p><div class="language-tsx highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre><span class="c1">/// &lt;reference path="./.sst/platform/config.d.ts" /&gt;</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">$config</span><span class="p">({</span>
  <span class="nx">app</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">my-app</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">removal</span><span class="p">:</span> <span class="nx">input</span><span class="p">?.</span><span class="nx">stage</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">production</span><span class="dl">"</span> <span class="p">?</span> <span class="dl">"</span><span class="s2">retain</span><span class="dl">"</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">remove</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">home</span><span class="p">:</span> <span class="dl">"</span><span class="s2">aws</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">providers</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">aws</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">region</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ap-northeast-2</span><span class="dl">"</span><span class="p">,</span>
        <span class="p">},</span>
      <span class="p">},</span>
    <span class="p">};</span>
  <span class="p">},</span>
  <span class="na">console</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">autodeploy</span><span class="p">:</span> <span class="p">{</span>
      <span class="nx">target</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span>
          <span class="nx">event</span><span class="p">.</span><span class="kd">type</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">branch</span><span class="dl">"</span> <span class="o">&amp;&amp;</span>
          <span class="nx">event</span><span class="p">.</span><span class="nx">action</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">pushed</span><span class="dl">"</span> <span class="o">&amp;&amp;</span>
          <span class="nx">event</span><span class="p">.</span><span class="nx">branch</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">main</span><span class="dl">"</span>
        <span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="p">{</span>
            <span class="na">stage</span><span class="p">:</span> <span class="dl">"</span><span class="s2">production</span><span class="dl">"</span><span class="p">,</span>
          <span class="p">};</span>
        <span class="p">}</span>
      <span class="p">},</span>
    <span class="p">},</span>
  <span class="p">},</span>
  <span class="k">async</span> <span class="nx">run</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">new</span> <span class="nx">sst</span><span class="p">.</span><span class="nx">aws</span><span class="p">.</span><span class="nx">Nextjs</span><span class="p">(</span><span class="dl">"</span><span class="s2">my-app</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">domain</span><span class="p">:</span> <span class="dl">"</span><span class="s2">joonhan.link</span><span class="dl">"</span><span class="p">,</span>
    <span class="p">});</span>
  <span class="p">},</span>
<span class="p">});</span>
</pre></table></code></div></div><p>여기서는 main 브랜치에 push 가 되었을 때만 autodeploy 하도록 했다.</p><p>autodeploy 가 되려면 위의 설정 파일이 GitHub Repository 에 올라가있어야 한다.</p><h3 id="console-과-github-repository-연결">console 과 GitHub Repository 연결</h3><p>console 첫 페이지에서 [Manage workspace] 클릭.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2024/2024-10-02-deploy-nextjs-using-sst/26.png" alt="26.png" /></p><p>페이지 하단의 [GitHub] 슬라이드 버튼을 클릭한다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2024/2024-10-02-deploy-nextjs-using-sst/27.png" alt="27.png" /></p><p>연결하고자 하는 Repository 를 선택하는 페이지가 표시된다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2024/2024-10-02-deploy-nextjs-using-sst/28.png" alt="28.png" /></p><p>연결하고자 하는 계정 또는 조직을 선택한다.</p><p>[Only select repositories] 선택 후 연결하고자 하는 Repository 이름을 검색해서 선택한다.</p><p>선택이 끝나면 하단의 [Install] 버튼을 클릭한다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2024/2024-10-02-deploy-nextjs-using-sst/29.png" alt="29.png" /></p><p>연결이 되면 아래와 같이 표시된다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2024/2024-10-02-deploy-nextjs-using-sst/30.png" alt="30.png" /></p><p>메인 페이지로 돌아가보면 아래의 이미지와 같이 배포한 애플리케이션이 보인다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2024/2024-10-02-deploy-nextjs-using-sst/31.png" alt="31.png" /></p><p>만약 보이지 않고 ‘Searching for apps…’ 문구만 표시된다면 [Manage workspace] 클릭 후 [Accounts] 에서 AWS 계정의 [Rescan] 버튼을 클릭한다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2024/2024-10-02-deploy-nextjs-using-sst/32.png" alt="32.png" /></p><p>정상적으로 애플리케이션이 표시되면 생성한 애플리케이션 (위의 이미지에서는 my-app)을 클릭 후 [SETTINGS] 페이지로 진입한다.</p><p>[Autodeploy] 항목에서 연결하고자 하는 Repository 를 선택한다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2024/2024-10-02-deploy-nextjs-using-sst/33.png" alt="33.png" /></p><p>[Select] 버튼을 클릭한다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2024/2024-10-02-deploy-nextjs-using-sst/34.png" alt="34.png" /></p><p>[Branch environment] 클릭.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2024/2024-10-02-deploy-nextjs-using-sst/35.png" alt="35.png" /></p><p>[STAGE] 에는 production 입력하고, [AWS ACCOUNT] 를 선택한 뒤 [Add Environment] 버튼 클릭.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2024/2024-10-02-deploy-nextjs-using-sst/36.png" alt="36.png" /></p><p>아래와 같이 표시되면 정상적으로 연결된 것이다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2024/2024-10-02-deploy-nextjs-using-sst/37.png" alt="37.png" /></p><p>이제 main 브랜치에 push 하면 [AUTODEPLOY] 탭에서 배포가 진행 중인 것을 확인할 수 있다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2024/2024-10-02-deploy-nextjs-using-sst/38.png" alt="38.png" /></p><p>[In Progress] 를 클릭하면 아래와 같이 로그를 표시해주는 페이지로 이동한다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2024/2024-10-02-deploy-nextjs-using-sst/39.png" alt="39.png" /></p><h3 id="autodeploy-해제">AUTODEPLOY 해제</h3><p>[SETTINGS] 탭에서 [Disconnect] 버튼을 클릭한다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2024/2024-10-02-deploy-nextjs-using-sst/40.png" alt="40.png" /></p><h1 id="참고자료">참고자료</h1><ul><li><a href="https://sst.dev/docs/start/aws/nextjs">Next.js on AWS with SST</a> [SST]<li><a href="https://github.com/sst/ion/issues/281">NoSuchBucket error with ‘sst deploy’ #281</a> [GitHub]</ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/aws/'>AWS</a>, <a href='/categories/nextjs/'>Nextjs</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=[Next.js] Vercel 대신 AWS 에 배포하기(feat.SST) - Dev Joon&url=https://han-joon-hyeok.github.io/posts/deploy-nextjs-using-sst/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=[Next.js] Vercel 대신 AWS 에 배포하기(feat.SST) - Dev Joon&u=https://han-joon-hyeok.github.io/posts/deploy-nextjs-using-sst/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=[Next.js] Vercel 대신 AWS 에 배포하기(feat.SST) - Dev Joon&url=https://han-joon-hyeok.github.io/posts/deploy-nextjs-using-sst/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/c-bitwise-operation-between-different-integer-sizes/">[C언어] 자료형 크기 차이로 인한 비트 연산 오류 해결 방법</a><li><a href="/posts/connect-to-ec2-without-ssh-key-using-session-manager/">[AWS] EC2 인스턴스 ssh 키 없이 터미널 접속하는 방법 (AWS Session Manager)</a><li><a href="/posts/how-to-access-geo-restricted-websites-using-mullvad-vpn/">국가 제한이 걸린 사이트에 접속하는 방법 (feat. Mullvad VPN)</a><li><a href="/posts/network-overview/">네트워크 LAN, WAN / 스위치, 라우터 / IP 주소 / 서브넷 개념 정리</a><li><a href="/posts/what-is-nat/">NAT란?</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/programmers/">programmers</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/level2/">level2</a> <a class="post-tag" href="/tags/level1/">level1</a> <a class="post-tag" href="/tags/javascript/">JavaScript</a> <a class="post-tag" href="/tags/os/">os</a> <a class="post-tag" href="/tags/pipex/">pipex</a> <a class="post-tag" href="/tags/born2beroot/">born2beroot</a> <a class="post-tag" href="/tags/git/">git</a> <a class="post-tag" href="/tags/data-structure/">Data Structure</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/next-js-failed-to-load-swc-binary/"><div class="card-body"> <span class="timeago small" > Mar 4, 2024 <i class="unloaded">2024-03-04T00:30:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[Next.js] Failed to load SWC binary for linux/x64 해결 방법</h3><div class="text-muted small"><p> 실행 환경 OS: MacOS(Intel) Sonoma 14.2.1 Node : 21.1.0 npm : 10.5.0 문제 상황 Next.js 개발 서버를 실행하기 위해 npm run dev 를 실행했다. 하지만 Failed to load SWC binary for linux/x64, see more info here: htt...</p></div></div></a></div><div class="card"> <a href="/posts/aws-s3-presigned-url-upload-with-java-spring-and-next-js/"><div class="card-body"> <span class="timeago small" > May 29, 2024 <i class="unloaded">2024-05-29T16:20:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[Spring/Next.js] AWS S3 Presigned URL 이용해서 이미지 업로드 및 조회 구현하기</h3><div class="text-muted small"><p> 실행 환경 OS: MacOS Sonoma 14.5 Java: 17 Spring Boot: 3.2.3 Spring AWS S3: 3.0.0 Next.js: 14.0.4 개요 프론트는 Next.js, 백엔드는 Java Spring 을 이용한 웹 프로젝트에서 AWS S3 Presigned URL 을 이용한 이미지 업로드를 구현한 ...</p></div></div></a></div><div class="card"> <a href="/posts/installing-docker-and-docker-compose-in-amazon-linux-2023/"><div class="card-body"> <span class="timeago small" > Sep 2, 2024 <i class="unloaded">2024-09-02T11:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Amazon Linux 2023 docker compose 설치</h3><div class="text-muted small"><p> 개요 AWS EC2 에서 사용하는 Amazon Linux 2023 에서 Docker 와 Docker Compose 를 설치하는 방법을 정리했다. Docker 설치 패키지를 업데이트 한다. sudo yum update -y docker 를 설치한다. sudo yum install -y ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/express-err-require-esm-error/" class="btn btn-outline-primary" prompt="Older"><p>[Express] ERR_REQUIRE_ESM 오류 해결하기</p></a> <a href="/posts/aws-eks-study-review/" class="btn btn-outline-primary" prompt="Newer"><p>[EKS] AWS EKS Workshop 실습 스터디 2기 내용 정리</p></a></div><script src="https://utteranc.es/client.js" repo="Han-Joon-Hyeok/Han-Joon-Hyeok.github.io" issue-term="pathname" label="Comments" theme="preferred-color-scheme" crossorigin="anonymous" async> </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/han-joon-hyeok">Joon Hyeok Han</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/programmers/">programmers</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/level2/">level2</a> <a class="post-tag" href="/tags/level1/">level1</a> <a class="post-tag" href="/tags/javascript/">JavaScript</a> <a class="post-tag" href="/tags/os/">os</a> <a class="post-tag" href="/tags/pipex/">pipex</a> <a class="post-tag" href="/tags/born2beroot/">born2beroot</a> <a class="post-tag" href="/tags/git/">git</a> <a class="post-tag" href="/tags/data-structure/">Data Structure</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://han-joon-hyeok.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
