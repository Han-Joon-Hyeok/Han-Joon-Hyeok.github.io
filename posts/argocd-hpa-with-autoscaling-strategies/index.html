<!DOCTYPE html><html lang="ko-KR" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.3.0" /><meta property="og:title" content="[ArgoCD] 무중단 배포 전략과 함께 HPA 적용하기" /><meta name="author" content="Joon Hyeok Han" /><meta property="og:locale" content="ko_KR" /><meta name="description" content="개요" /><meta property="og:description" content="개요" /><link rel="canonical" href="https://han-joon-hyeok.github.io/posts/argocd-hpa-with-autoscaling-strategies/" /><meta property="og:url" content="https://han-joon-hyeok.github.io/posts/argocd-hpa-with-autoscaling-strategies/" /><meta property="og:site_name" content="Dev Joon" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-11-10T15:50:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="[ArgoCD] 무중단 배포 전략과 함께 HPA 적용하기" /><meta name="twitter:site" content="@" /><meta name="twitter:creator" content="@Joon Hyeok Han" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Joon Hyeok Han"},"dateModified":"2024-11-10T15:50:00+09:00","datePublished":"2024-11-10T15:50:00+09:00","description":"개요","headline":"[ArgoCD] 무중단 배포 전략과 함께 HPA 적용하기","mainEntityOfPage":{"@type":"WebPage","@id":"https://han-joon-hyeok.github.io/posts/argocd-hpa-with-autoscaling-strategies/"},"url":"https://han-joon-hyeok.github.io/posts/argocd-hpa-with-autoscaling-strategies/"}</script><title>[ArgoCD] 무중단 배포 전략과 함께 HPA 적용하기 | Dev Joon</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-SKST7KNWSJ"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-SKST7KNWSJ'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/profile.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Dev Joon</a></div><div class="site-subtitle font-italic">성장하는 개발자, 한준혁입니다.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/Han-Joon-Hyeok" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['joonhyeok.han','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>[ArgoCD] 무중단 배포 전략과 함께 HPA 적용하기</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>[ArgoCD] 무중단 배포 전략과 함께 HPA 적용하기</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Nov 10, 2024, 3:50 PM +0900" > Nov 10, 2024 <i class="unloaded">2024-11-10T15:50:00+09:00</i> </span> by <span class="author"> Joon Hyeok Han </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1859 words">10 min</span></div></div><div class="post-content"><h1 id="개요">개요</h1><p>Kubernetes의 HPA(Horizontal Pod Autoscaler) 객체를 활용하여 무중단 배포 전략(Rolling Update, Canary)을 설정하고, 오토스케일링을 구현하는 방법을 정리했다.</p><h1 id="hpa-개념">HPA 개념</h1><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2024/2024-11-10-argocd-hpa-with-autoscaling-strategies/1.png" alt="1.png" /></p><p>출처: <a href="https://www.kreyman.de/index.php/kubernetes/249-was-ist-kubernetes-autoscaling">Was ist (Kubernetes) Autoscaling? VPA vs. HPA</a> [kreyman]</p><p>HPA(Horizontal Pod Autoscaler)는 특정 파드에 부하가 발생했을 때 동일한 성능의 파드를 추가로 생성해 부하를 분산하는 Kubernetes 객체이다. CPU 사용률, 메모리 사용률 등을 기준으로 파드 생성(스케일 아웃)을 판단하며, 부하가 줄어들면 일정 시간 후 파드 수를 줄이는(스케일 인) 방식으로 작동한다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2024/2024-11-10-argocd-hpa-with-autoscaling-strategies/2.png" alt="2.png" /></p><p>출처: <a href="https://nirsa.tistory.com/187">[Kubernetes] 쿠버네티스 HPA 개념과 구성 (HorizontalPodAutoscaler, 오토스케일러)</a> [티스토리]</p><p>HPA는 <code class="language-plaintext highlighter-rouge">metrics-server</code>에서 수집한 파드 메트릭을 바탕으로 추가할 파드 개수를 계산하여 오토스케일링을 수행한다.</p><h1 id="metrics-server-설치">metrics-server 설치</h1><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2024/2024-11-10-argocd-hpa-with-autoscaling-strategies/3.png" alt="3.png" /></p><p>출처: <a href="https://kubernetes.io/docs/tasks/debug/debug-cluster/resource-metrics-pipeline/">Resource metrics pipeline</a> [kubernetes.io]</p><p>HPA는 <code class="language-plaintext highlighter-rouge">metrics-server</code>가 수집한 메트릭 데이터를 활용해 오토 스케일링을 수행한다. <code class="language-plaintext highlighter-rouge">metrics-server</code>는 각 노드에서 실행되는 <code class="language-plaintext highlighter-rouge">kubelet</code> 에 있는 <code class="language-plaintext highlighter-rouge">cAdvisor</code> 를 통해 메트릭을 수집하고, Kubernetes API 서버에 전달한다. API 서버는 이 메트릭을 바탕으로 오토스케일링을 수행하거나, 사용자가 <code class="language-plaintext highlighter-rouge">kubectl top</code> 명령어로 메트릭을 조회할 수 있도록 한다.</p><h2 id="cadvisor">cAdvisor</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/2024/2024-11-10-argocd-hpa-with-autoscaling-strategies/4.png" alt="4.png" /></p><p>출처: <a href="https://github.com/DataDog/the-monitor/blob/master/kubernetes/how-to-collect-and-graph-kubernetes-metrics.md">Datadog</a> [github]</p><p>cAdvisor는 Container Advisor의 약자로, 컨테이너의 리소스 사용량과 성능을 모니터링하는 데몬 프로그램이다. Kubernetes뿐만 아니라 Docker 환경에서도 사용할 수 있다. Kubernetes에서는 파드 안에서 컨테이너가 실행될 수 있도록 하는 <code class="language-plaintext highlighter-rouge">kubelet</code>에 <code class="language-plaintext highlighter-rouge">cAdvisor</code>가 함께 포함되어 있어 파드와 노드의 메트릭을 수집해 오토스케일링을 수행할 수 있도록 한다.</p><h2 id="설치-방법">설치 방법</h2><p>아래의 명령어로 <code class="language-plaintext highlighter-rouge">metrics-server</code> 를 설치한다.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl apply <span class="nt">-f</span> https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml
</pre></table></code></div></div><p>이후, 다음 명령어로 설정을 수정한다.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl edit deployments.apps <span class="nt">-n</span> kube-system metrics-server
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">spec.template.spec.containers.args</code> 항목에 다음 옵션을 추가한다.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nt">--kubelet-insecure-tls</span>
<span class="nt">--kubelet-preferred-address-types</span><span class="o">=</span>InternalIP, ExternalIP, Hostname
</pre></table></code></div></div><p>정상적으로 설치되었는지 아래 명령어로 확인한다.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>kubectl top nodes
<span class="c">#NAME              CPU(cores)   CPU%   MEMORY(bytes)   MEMORY%</span>
<span class="c">#k8s-master-node   557m         27%    2957Mi          77%</span>
</pre></table></code></div></div><h1 id="yaml-파일-작성">yaml 파일 작성</h1><p>무중단 배포 전략에 따라 HPA 설정 방식이 달라진다.</p><p><code class="language-plaintext highlighter-rouge">Rolling Update</code> 전략에는 <code class="language-plaintext highlighter-rouge">Deployment</code> 객체를, <code class="language-plaintext highlighter-rouge">Canary</code> 및 <code class="language-plaintext highlighter-rouge">Blue/Green</code> 배포 전략에는 <code class="language-plaintext highlighter-rouge">Rollout</code> 객체를 사용하여 HPA를 설정한다. 아래는 Helm Chart 템플릿 파일을 작성하는 방법이다.</p><h2 id="rolling-update">Rolling Update</h2><h3 id="디렉토리-구조">디렉토리 구조</h3><p><code class="language-plaintext highlighter-rouge">Rolling Update</code> 전략에서는 <code class="language-plaintext highlighter-rouge">Deployment</code> 객체를 사용한다. 디렉토리 구조는 다음과 같다.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nb">.</span>
├── demo-hpa-no-rollout
│   ├── Chart.yaml
│   ├── templates
│   │   ├── deployment.yaml
│   │   ├── hpa.yaml
│   │   └── service.yaml
│   └── values.yaml
└── demo-hpa-no-rollout-application.yaml
</pre></table></code></div></div><h3 id="deploymentyaml">deployment.yaml</h3><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">-deployment</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> 
  <span class="na">namespace</span><span class="pi">:</span> 
<span class="na">spec</span><span class="pi">:</span>
<span class="c1"># replicas:  # HPA 사용하려면 제거해야함</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> 
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">annotations</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> 
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span> 
        <span class="na">name</span><span class="pi">:</span> 
        <span class="na">resources</span><span class="pi">:</span> <span class="c1"># 반드시 있어야 함</span>
        <span class="na">ports</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">http</span>
            <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
            <span class="na">containerPort</span><span class="pi">:</span> 
</pre></table></code></div></div><h3 id="hpayaml">hpa.yaml</h3><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">autoscaling/v2</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">HorizontalPodAutoscaler</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">-hpa</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">minReplicas</span><span class="pi">:</span> 
  <span class="na">maxReplicas</span><span class="pi">:</span> 
  <span class="na">scaleTargetRef</span><span class="pi">:</span>
    <span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
    <span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">-deployment</span>
  <span class="na">metrics</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s">Resource</span>
    <span class="na">resource</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">cpu</span>
      <span class="na">target</span><span class="pi">:</span>
        <span class="na">averageUtilization</span><span class="pi">:</span> 
        <span class="na">type</span><span class="pi">:</span> <span class="s">Utilization</span>
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">spec.minReplicas</code>: 최소 파드 수<li><code class="language-plaintext highlighter-rouge">spec.maxReplicas</code>: 최대 파드 수<li><code class="language-plaintext highlighter-rouge">spec.scaleTargetRef</code><ul><li><code class="language-plaintext highlighter-rouge">apiVersion</code>: Deployment 에 해당하는 <code class="language-plaintext highlighter-rouge">apps/v1</code> 작성<li><code class="language-plaintext highlighter-rouge">kind</code>: <code class="language-plaintext highlighter-rouge">Deployment</code> 작성<li><code class="language-plaintext highlighter-rouge">name</code>: Deployment 객체의 metadata.name 에 해당하는 값 입력</ul><li><code class="language-plaintext highlighter-rouge">spec.replicas</code>: HPA 적용 시 제거해야 하며, 파드 개수는 HPA 가 관리한다.<ul><li>참고자료: https://argo-cd.readthedocs.io/en/release-1.8/user-guide/best_practices/#leaving-room-for-imperativeness</ul><li><code class="language-plaintext highlighter-rouge">spec.template.spec.containers.resources</code>: HPA 는 메트릭을 기준으로 작동하기 때문에 <code class="language-plaintext highlighter-rouge">request</code> 와 <code class="language-plaintext highlighter-rouge">limit</code> 를 반드시 입력해야 한다.</ul><h3 id="serviceyaml">service.yaml</h3><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> 
  <span class="na">name</span><span class="pi">:</span> 
  <span class="na">namespace</span><span class="pi">:</span> 
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">ports</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span> 
    <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">http</span>
    <span class="na">targetPort</span><span class="pi">:</span> 
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> 
</pre></table></code></div></div><h3 id="demo-hpa-no-rollout-applicationyaml">demo-hpa-no-rollout-application.yaml</h3><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">argoproj.io/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Application</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">demo-hpa-no-rollout</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">argocd</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">project</span><span class="pi">:</span> <span class="s">default</span>
  <span class="na">source</span><span class="pi">:</span>
    <span class="na">path</span><span class="pi">:</span> <span class="s">demo-hpa-no-rollout</span>
    <span class="na">repoURL</span><span class="pi">:</span> <span class="s">https://github.com/[org]/[repository]</span>
    <span class="na">targetRevision</span><span class="pi">:</span> <span class="s">HEAD</span>
    <span class="na">helm</span><span class="pi">:</span>
      <span class="na">valueFiles</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">values.yaml</span>
  <span class="na">destination</span><span class="pi">:</span>
    <span class="na">server</span><span class="pi">:</span> <span class="s">https://kubernetes.default.svc</span>
    <span class="na">namespace</span><span class="pi">:</span> <span class="s">default</span>
  <span class="na">syncPolicy</span><span class="pi">:</span>
    <span class="na">automated</span><span class="pi">:</span> <span class="pi">{}</span>
</pre></table></code></div></div><h3 id="valuesyaml">values.yaml</h3><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="na">app</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">demo-hpa-no-rollout"</span>
  <span class="na">image</span><span class="pi">:</span> <span class="s2">"</span><span class="s">argoproj/rollouts-demo:blue"</span>
  <span class="na">port</span><span class="pi">:</span> <span class="m">80</span>
  <span class="na">minReplicas</span><span class="pi">:</span> <span class="m">1</span>
  <span class="na">maxReplicas</span><span class="pi">:</span> <span class="m">4</span>
  <span class="na">averageUtilization</span><span class="pi">:</span> <span class="m">30</span>
  <span class="na">resources</span><span class="pi">:</span>
    <span class="na">requests</span><span class="pi">:</span>
      <span class="na">cpu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">200m"</span>
      <span class="na">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">128Mi"</span>
    <span class="na">limits</span><span class="pi">:</span>
      <span class="na">cpu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">500m"</span>
      <span class="na">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">128Mi"</span>

<span class="na">podAnnotations</span><span class="pi">:</span> <span class="pi">{}</span>
<span class="na">podLabels</span><span class="pi">:</span>
  <span class="na">tier</span><span class="pi">:</span> <span class="s">backend</span>

<span class="na">service</span><span class="pi">:</span>
  <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">port</span><span class="pi">:</span> <span class="m">80</span>
</pre></table></code></div></div><h2 id="canary-전략">Canary 전략</h2><p>Blue/Green 전략도 Canary와 설정하는 방법은 비슷하기 때문에 생략했다.</p><h3 id="디렉토리-구조-1">디렉토리 구조</h3><p><code class="language-plaintext highlighter-rouge">Canary</code> 전략에서는 <code class="language-plaintext highlighter-rouge">Deployment</code> 객체 대신 <code class="language-plaintext highlighter-rouge">Rollout</code> 객체를 사용한다. 디렉토리 구조는 다음과 같다.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nb">.</span>
├── demo-hpa-with-rollout
│   ├── Chart.yaml
│   ├── templates
│   │   ├── hpa.yaml
│   │   ├── rollout.yaml
│   │   └── service.yaml
│   └── values.yaml
└── demo-hpa-with-rollout-application.yaml
</pre></table></code></div></div><h3 id="hpayaml-1">hpa.yaml</h3><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">autoscaling/v2</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">HorizontalPodAutoscaler</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">-hpa</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">minReplicas</span><span class="pi">:</span> 
  <span class="na">maxReplicas</span><span class="pi">:</span> 
  <span class="na">scaleTargetRef</span><span class="pi">:</span>
    <span class="na">apiVersion</span><span class="pi">:</span> <span class="s">argoproj.io/v1alpha1</span>
    <span class="na">kind</span><span class="pi">:</span> <span class="s">Rollout</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">-rollout</span>
  <span class="na">metrics</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s">Resource</span>
    <span class="na">resource</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">cpu</span>
      <span class="na">target</span><span class="pi">:</span>
        <span class="na">averageUtilization</span><span class="pi">:</span> 
        <span class="na">type</span><span class="pi">:</span> <span class="s">Utilization</span>
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">spec.scaleTargetRef</code><ul><li><code class="language-plaintext highlighter-rouge">apiVersion</code>: Rollout 에 해당하는 <code class="language-plaintext highlighter-rouge">argoproj.io/v1alpha1</code> 작성<li><code class="language-plaintext highlighter-rouge">kind</code>: <code class="language-plaintext highlighter-rouge">Rollout</code> 작성<li><code class="language-plaintext highlighter-rouge">name</code>: Rollout 객체의 <code class="language-plaintext highlighter-rouge">metadata.name</code> 에 해당하는 값 입력</ul></ul><h3 id="rolloutyaml">rollout.yaml</h3><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">argoproj.io/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Rollout</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">-rollout</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> 
    <span class="na">chart</span><span class="pi">:</span> <span class="s2">"</span><span class="s">-"</span>
    <span class="na">release</span><span class="pi">:</span> 
    <span class="na">heritage</span><span class="pi">:</span> 
<span class="na">spec</span><span class="pi">:</span>
<span class="c1"># replicas:  # HPA 사용하려면 제거해야함</span>
  <span class="na">revisionHistoryLimit</span><span class="pi">:</span> <span class="m">3</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> 
      <span class="na">release</span><span class="pi">:</span> 
  <span class="na">strategy</span><span class="pi">:</span>
    <span class="na">canary</span><span class="pi">:</span>
      <span class="na">canaryService</span><span class="pi">:</span> <span class="s">-canary</span>
      <span class="na">stableService</span><span class="pi">:</span> <span class="s">-stable</span>
      <span class="na">steps</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">setWeight</span><span class="pi">:</span> <span class="m">20</span>
        <span class="pi">-</span> <span class="na">pause</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">duration</span><span class="pi">:</span> <span class="nv">2s</span><span class="pi">}</span>
        <span class="pi">-</span> <span class="na">setWeight</span><span class="pi">:</span> <span class="m">40</span>
        <span class="pi">-</span> <span class="na">pause</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">duration</span><span class="pi">:</span> <span class="nv">2s</span><span class="pi">}</span>
        <span class="pi">-</span> <span class="na">setWeight</span><span class="pi">:</span> <span class="m">60</span>
        <span class="pi">-</span> <span class="na">pause</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">duration</span><span class="pi">:</span> <span class="nv">2s</span><span class="pi">}</span>
        <span class="pi">-</span> <span class="na">setWeight</span><span class="pi">:</span> <span class="m">80</span>
        <span class="pi">-</span> <span class="na">pause</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">duration</span><span class="pi">:</span> <span class="nv">2s</span><span class="pi">}</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">annotations</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> 
        <span class="na">release</span><span class="pi">:</span> 
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> 
          <span class="na">image</span><span class="pi">:</span> 
          <span class="na">resources</span><span class="pi">:</span> <span class="c1"># 반드시 입력</span>
          <span class="na">ports</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">http</span>
              <span class="na">containerPort</span><span class="pi">:</span> 
              <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">spec.replicas</code>: 마찬가지로 HPA 를 적용하려면 해당 속성을 사용하지 않아야 한다.<li><code class="language-plaintext highlighter-rouge">spec.template.spec.containers.resources</code>: 마찬가지로 request 와 limit 를 반드시 입력해주어야 한다.</ul><h3 id="serviceyaml-1">service.yaml</h3><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> 
  <span class="na">name</span><span class="pi">:</span> <span class="s">-canary</span>
  <span class="na">namespace</span><span class="pi">:</span> 
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">ports</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span> 
    <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">http</span>
    <span class="na">targetPort</span><span class="pi">:</span> 
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> 
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> 
  <span class="na">name</span><span class="pi">:</span> <span class="s">-stable</span>
  <span class="na">namespace</span><span class="pi">:</span> 
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">ports</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span> 
    <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">http</span>
    <span class="na">targetPort</span><span class="pi">:</span> 
  <span class="na">type</span><span class="pi">:</span> <span class="s">NodePort</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> 
</pre></table></code></div></div><h3 id="valuesyaml-1">values.yaml</h3><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="na">app</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">demo-hpa-with-rollout"</span>
  <span class="na">image</span><span class="pi">:</span> <span class="s2">"</span><span class="s">argoproj/rollouts-demo:blue"</span>
  <span class="na">port</span><span class="pi">:</span> <span class="m">80</span>
  <span class="na">minReplicas</span><span class="pi">:</span> <span class="m">1</span>
  <span class="na">maxReplicas</span><span class="pi">:</span> <span class="m">4</span>
  <span class="na">averageUtilization</span><span class="pi">:</span> <span class="m">30</span>
  <span class="na">resources</span><span class="pi">:</span>
    <span class="na">requests</span><span class="pi">:</span>
      <span class="na">cpu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">200m"</span>
      <span class="na">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">128Mi"</span>
    <span class="na">limits</span><span class="pi">:</span>
      <span class="na">cpu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">500m"</span>
      <span class="na">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">128Mi"</span>

<span class="na">podAnnotations</span><span class="pi">:</span> <span class="pi">{}</span>
<span class="na">podLabels</span><span class="pi">:</span>
  <span class="na">tier</span><span class="pi">:</span> <span class="s">backend</span>

<span class="na">service</span><span class="pi">:</span>
  <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">port</span><span class="pi">:</span> <span class="m">80</span>
</pre></table></code></div></div><h3 id="demo-hpa-with-rollout-applicationyaml">demo-hpa-with-rollout-application.yaml</h3><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">argoproj.io/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Application</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">demo-hpa-with-rollout</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">argocd</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">project</span><span class="pi">:</span> <span class="s">default</span>
  <span class="na">source</span><span class="pi">:</span>
    <span class="na">path</span><span class="pi">:</span> <span class="s">demo-hpa-with-rollout</span>
    <span class="na">repoURL</span><span class="pi">:</span> <span class="s">https://github.com/[org]/[repository]</span>
    <span class="na">targetRevision</span><span class="pi">:</span> <span class="s">HEAD</span>
    <span class="na">helm</span><span class="pi">:</span>
      <span class="na">valueFiles</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">values.yaml</span>
  <span class="na">destination</span><span class="pi">:</span>
    <span class="na">server</span><span class="pi">:</span> <span class="s">https://kubernetes.default.svc</span>
    <span class="na">namespace</span><span class="pi">:</span> <span class="s">default</span>
  <span class="na">syncPolicy</span><span class="pi">:</span>
    <span class="na">automated</span><span class="pi">:</span> <span class="pi">{}</span>
</pre></table></code></div></div><h1 id="부하-테스트">부하 테스트</h1><p>Helm Chart를 이용해 애플리케이션을 배포하고, HPA가 작동하는지 확인하기 위해 부하를 발생시킨다. 서비스 도메인으로 다음 명령어를 실행한다.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>kubectl run <span class="nt">-i</span> <span class="nt">--tty</span> load-generator <span class="se">\</span>
<span class="nt">--rm</span> <span class="se">\</span>
<span class="nt">--image</span><span class="o">=</span>busybox:1.28 <span class="se">\</span>
<span class="nt">--restart</span><span class="o">=</span>Never <span class="se">\</span>
<span class="nt">--</span> /bin/sh <span class="nt">-c</span> <span class="s2">"while sleep 0.01; do wget -q -O- http://[service-name].[namespace].svc; done"</span>
</pre></table></code></div></div><p>부하가 발생하고 나서 <code class="language-plaintext highlighter-rouge">kubectl top pod</code> 명령어를 실행해 파드가 자동으로 생성된 것을 확인한다. (초기 파드 개수 1개, 최대 파드 개수 4개)</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>kubectl top pod
<span class="c">#NAME                                CPU(cores)   MEMORY(bytes)</span>
<span class="c">#demo-hpa-rollout-7449969d75-7jdgl   151m         17Mi</span>
<span class="c">#demo-hpa-rollout-7449969d75-db4vg   174m         19Mi</span>
<span class="c">#demo-hpa-rollout-7449969d75-dnvt2   142m         11Mi</span>
<span class="c">#demo-hpa-rollout-7449969d75-xvrns   143m         11Mi</span>
<span class="c">#load-generator                      24m          1Mi</span>
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/argocd/'>argocd</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=[ArgoCD] 무중단 배포 전략과 함께 HPA 적용하기 - Dev Joon&url=https://han-joon-hyeok.github.io/posts/argocd-hpa-with-autoscaling-strategies/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=[ArgoCD] 무중단 배포 전략과 함께 HPA 적용하기 - Dev Joon&u=https://han-joon-hyeok.github.io/posts/argocd-hpa-with-autoscaling-strategies/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=[ArgoCD] 무중단 배포 전략과 함께 HPA 적용하기 - Dev Joon&url=https://han-joon-hyeok.github.io/posts/argocd-hpa-with-autoscaling-strategies/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/c-bitwise-operation-between-different-integer-sizes/">[C언어] 자료형 크기 차이로 인한 비트 연산 오류 해결 방법</a><li><a href="/posts/connect-to-ec2-without-ssh-key-using-session-manager/">[AWS] EC2 인스턴스 ssh 키 없이 터미널 접속하는 방법 (AWS Session Manager)</a><li><a href="/posts/how-to-access-geo-restricted-websites-using-mullvad-vpn/">국가 제한이 걸린 사이트에 접속하는 방법 (feat. Mullvad VPN)</a><li><a href="/posts/network-overview/">네트워크 LAN, WAN / 스위치, 라우터 / IP 주소 / 서브넷 개념 정리</a><li><a href="/posts/what-is-nat/">NAT란?</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/programmers/">programmers</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/level2/">level2</a> <a class="post-tag" href="/tags/level1/">level1</a> <a class="post-tag" href="/tags/javascript/">JavaScript</a> <a class="post-tag" href="/tags/os/">os</a> <a class="post-tag" href="/tags/pipex/">pipex</a> <a class="post-tag" href="/tags/born2beroot/">born2beroot</a> <a class="post-tag" href="/tags/git/">git</a> <a class="post-tag" href="/tags/data-structure/">Data Structure</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/argo-rollouts-with-appproject/"><div class="card-body"> <span class="timeago small" > Nov 3, 2024 <i class="unloaded">2024-11-03T17:20:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[ArgoCD] RBAC 적용을 위한 AppProject와 무중단 배포를 위한 Argo Rollouts 함께 사용하기</h3><div class="text-muted small"><p> Argo Rollouts 설치(helm) 1. 플레인 쿠버네티스 argo-rollouts 네임스페이스 생성 후 설치 kubectl create ns argo-rollouts helm install argo-rollouts argo/argo-rollouts --version 2.35.1 --namespace argo-rollouts 2. EKS...</p></div></div></a></div><div class="card"> <a href="/posts/argocd-canary-deployment-traffic-load-balancing-analysis/"><div class="card-body"> <span class="timeago small" > Nov 17, 2024 <i class="unloaded">2024-11-17T21:10:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[ArgoCD] 무중단 배포 canary 전략의 파드 개수에 따른 로드밸런싱</h3><div class="text-muted small"><p> 개요 ArgoCD에서 지원하는 무중단 배포 전략 중 하나인 canary 전략을 사용해서 업데이트를 진행할 때, 파드의 개수에 따라 트래픽의 로드 밸런싱이 어떻게 이루어지는지 정리했다. canary 개념 새롭게 업데이트 하는 버전을 v2, 기존 실행하고 있는 버전을 v1이라고 해보자. canary 배포 전략에서는 v1에 보내던 트래픽을 v2로 점...</p></div></div></a></div><div class="card"> <a href="/posts/argocd-custom-trigger-notifications/"><div class="card-body"> <span class="timeago small" > Dec 1, 2024 <i class="unloaded">2024-12-01T16:40:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[ArgoCD] 사용자 정의 트리거(Custom Trigger)를 활용한 알림 설정하기</h3><div class="text-muted small"><p> 개요 ArgoCD에서 제공하는 기본 트리거 외에도 사용자가 새롭게 트리거를 정의하여 알림을 보낼 수 있습니다. ArgoCD와 Argo Rollouts 모두 커스텀 트리거를 지원하며, 적용 방법은 동일하므로 이 글에서는 ArgoCD를 기준으로 설명합니다. 1. Notification ConfigMap 수정 ConfigMap 파일 수정 알림 설정...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/argo-rollouts-with-appproject/" class="btn btn-outline-primary" prompt="Older"><p>[ArgoCD] RBAC 적용을 위한 AppProject와 무중단 배포를 위한 Argo Rollouts 함께 사용하기</p></a> <a href="/posts/argocd-canary-deployment-traffic-load-balancing-analysis/" class="btn btn-outline-primary" prompt="Newer"><p>[ArgoCD] 무중단 배포 canary 전략의 파드 개수에 따른 로드밸런싱</p></a></div><script src="https://utteranc.es/client.js" repo="Han-Joon-Hyeok/Han-Joon-Hyeok.github.io" issue-term="pathname" label="Comments" theme="preferred-color-scheme" crossorigin="anonymous" async> </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/han-joon-hyeok">Joon Hyeok Han</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/programmers/">programmers</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/level2/">level2</a> <a class="post-tag" href="/tags/level1/">level1</a> <a class="post-tag" href="/tags/javascript/">JavaScript</a> <a class="post-tag" href="/tags/os/">os</a> <a class="post-tag" href="/tags/pipex/">pipex</a> <a class="post-tag" href="/tags/born2beroot/">born2beroot</a> <a class="post-tag" href="/tags/git/">git</a> <a class="post-tag" href="/tags/data-structure/">Data Structure</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://han-joon-hyeok.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
